---
- name: Enable CodeReady Builder Repository using ansible_architecture fact
  ansible.builtin.command: >
    subscription-manager repos --enable "codeready-builder-for-rhel-8-{{ ansible_architecture }}-rpms"
  register: crb_enable_output
  changed_when: "'Error' not in crb_enable_output.stderr"
  become: true

- name: Install EPEL Release RPM via DNF module
  ansible.builtin.dnf:
    name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
    state: present
  become: true

- name: Install required packages (schroot, libsepol, json-c)
  ansible.builtin.dnf:
    name:
      - schroot
      - libsepol
      - json-c
    state: present
  become: true

- name: Verify repository list (dnf repolist)
  ansible.builtin.command: dnf repolist
  register: repolist_output
  changed_when: false
  become: true

- name: Print repository list output
  ansible.builtin.debug:
    var: repolist_output.stdout_lines
